
describe("puretester", () => {

  const fs = require("fs");
  const path = require("path");

  const puretester = require("../../ishell/puretester");
  // const fsHelper = require("../../ishell/fsHelper");

  function checkPuretester(dir, mode, shouldBePure = true) {
    const { files, filepaths } = puretester.setup(dir);

    const { failMsg } = puretester.runPuretests(
      filepaths,
      files,
      mode
    );

    if (shouldBePure && failMsg) {
      fail(`Pure module '${file}' marked as impure`);
    } else if (!shouldBePure && !failMsg) {
      fail(`Impure module '${file}' marked as pure`);
    }
  }

  it("works in 'hasArgs' mode on pure methods", () => {
    const dir = `${__dirname}/testmodules/hasArgs/pure`;
    checkPuretester(dir, puretester.testModes.hasArgs);
  });

  it("works in 'hasArgs' mode on impure methods", () => {
    const dir = `${__dirname}/testmodules/hasArgs/impure`;
    checkPuretester(dir, puretester.testModes.hasArgs, false);
  });

  it("works in 'returnsValue' mode on pure methods", () => {
    const dir = `${__dirname}/testmodules/returnsValue/pure`;
    checkPuretester(dir, puretester.testModes.returnsValue);
  });

  it("works in 'returnsValue' mode on impure methods", () => {
    const dir = `${__dirname}/testmodules/returnsValue/impure`;
    checkPuretester(dir, puretester.testModes.returnsValue, false);
  });

  it("works in 'isPureExpression' mode on pure methods", () => {
    const dir = `${__dirname}/testmodules/isPureExpression/pure`;
    checkPuretester(dir, puretester.testModes.isPureExpression);
  });

  it("works in 'isPureExpression' mode on impure methods", () => {
    const dir = `${__dirname}/testmodules/isPureExpression/impure`;
    checkPuretester(dir, puretester.testModes.isPureExpression, false);
  });
});