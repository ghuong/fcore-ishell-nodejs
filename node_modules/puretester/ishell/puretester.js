const path = require("path");

const { testModes } = require("./config");
const fsHelper = require("./fsHelper");

const rewriteModulesIntoSandboxes = require("./rewriteModulesIntoSandboxes");
const { runPuretests } = require("./runPuretests");

/**
 * 
 * @param {String} dir directory with fcore files
 * @param {String} rewriteDir directory to store re-written files
 * @returns an object { files, filepaths }, where
 *  - files: list of relative filepaths relative in dir
 *  - filepaths: list of absolute filepaths in dir
 */
function setup(dir, rewriteDir) {
  if (rewriteDir) fsHelper.removeDir(rewriteDir); // nuke rewrites directory

  const files = fsHelper.listFiles(dir);
  const filepaths = files.map((f) => path.join(dir, f));
  return { files, filepaths };
}

function teardown(rewriteDir) {
  fsHelper.removeDir(rewriteDir);
}

module.exports = {
  setup,
  teardown,
  runPuretests,
  rewriteModulesIntoSandboxes,
  testModes,
}